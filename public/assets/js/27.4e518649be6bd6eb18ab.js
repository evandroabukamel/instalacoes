webpackJsonp([27],{1867:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(a(230)),o=c(a(235)),n=c(a(62)),s=c(a(95)),r=c(a(231)),d=a(40);function c(e){return e&&e.__esModule?e:{default:e}}Vue.axios.CancelToken;t.default={name:"modal-tirar-foto",data:function(){return{showVideo:!0,showCanvas:!1,isLoading:!1,mediaStream:null,endereco:{}}},props:{idAgendamento:null},computed:{},methods:(0,s.default)({},(0,d.mapActions)(["reverseGeocode"]),{snap:function(){var e=this.$refs.canvas.getContext("2d"),t=this.$refs.video;e.drawImage(t,0,0,640,480),t.pause(),this.showVideo=!1,this.showCanvas=!0},replayVideo:function(){this.$refs.video.play(),this.showCanvas=!1,this.showVideo=!0},descartar:function(){this.replayVideo()},enviar:function(){this.isLoading=!0,this.sendImage()},sendImage:function(){var e=this,t=this.$refs.canvas.toDataURL("image/png");e.upload(t).then(function(t){t&&e.$toast.open({message:t.message?t.message:"Foto salva com sucesso.",type:"is-success",position:"is-top",duration:5e3}),e.$emit("sent",{id:t.idFoto,endereco:e.endereco}),e.replayVideo()}).catch(function(t){t&&e.$toast.open({message:t.message?t.message:"Erro ao salvar foto.",type:"is-danger",position:"is-top",duration:5e3}),e.replayVideo()})},upload:function(e){var t=this;return new n.default(function(a,i){t.axios.post("/agendamento/enviarFoto",{id:t.idAgendamento,image:e,type:"image/png",width:640,height:480,endereco:t.endereco}).then(function(e){t.isLoading=!1,a(e.data)}).catch(function(e){t.isLoading=!1,i(e.response.data)})})},clickCancel:function(){this.stopVideo(),this.$parent.close()},stopVideo:function(){var e=this.$refs.video,t=this.mediaStream.getTracks();e.pause(),t.forEach(function(e){e.stop(),e.enabled=!1}),e.src=null},geolocationSuccess:function(e){var t=this;this.endereco=new r.default({id:null,logradouro:"",numero:"",complemento:"",bairro:"",cidade:"",estado:null,pais:"",cep:"",posicao:{}});var a=e.coords;this.endereco.posicao={latitude:a.latitude,longitude:a.longitude},this.reverseGeocode(a).then(function(e){if("object"==(void 0===e?"undefined":(0,o.default)(e))&&(0,i.default)(e).length>0){t.endereco.logradouro=e.Address.Street||"",t.endereco.numero=e.Address.HouseNumber||"",t.endereco.bairro=e.Address.District||"",t.endereco.cidade=e.Address.City||"",t.endereco.estado=e.Address.State||null,t.endereco.cep=e.Address.PostalCode||"";var a=e.Address.AdditionalData||[];for(var n in a)if("CountryName"==n.key){t.endereco.pais=n.value;break}t.$toast.open({message:"Endereço da foto encontrado.",type:"is-success",position:"is-top",duration:5e3})}}).catch(function(e){Boolean(e)&&"string"==typeof e&&t.$toast.open({message:e,type:"is-danger",position:"is-top",duration:5e3})})},geolocationError:function(e){this.$toast.open({message:"Erro ao obter sua geolocalização.\nErro "+e.code+": "+e.message,type:"is-danger",position:"is-top",duration:5e3})}}),mounted:function(){var e=this;this.$toast.open({message:"É necessário permitir a geolocalização do seu navegador.",type:"is-info",position:"is-top",duration:5e3}),"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(t){return e.geolocationSuccess(t)},function(t){return e.geolocationError(t)},{enableHighAccuracy:!0,timeout:6e4,maximumAge:0}):this.$toast.open({message:"É necessário permitir a geolocalização do seu navegador.",type:"is-warning",position:"is-top",duration:5e3});var t=this.$refs.video,a=this;navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:{width:800,height:600,facingMode:"environment"}}).then(function(e){a.mediaStream=e,t.src=window.URL.createObjectURL(e),t.play()}):navigator.getUserMedia?navigator.getUserMedia({video:{width:800,height:600,facingMode:"environment"}},function(e){a.mediaStream=e,t.src=e,t.play()},errBack):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia({video:{width:800,height:600,facingMode:"environment"}},function(e){a.mediaStream=e,t.src=window.webkitURL.createObjectURL(e),t.play()},errBack):navigator.mozGetUserMedia&&navigator.mozGetUserMedia({video:{width:800,height:600,facingMode:"environment"}},function(e){a.mediaStream=e,t.src=window.URL.createObjectURL(e),t.play()},errBack)},beforeDestroy:function(){this.stopVideo()}},e.exports=t.default},1880:function(e,t,a){(e.exports=a(548)(!0)).push([e.i,"#btn-snap[data-v-ab6ba9f2]{--height:1.5rem;border-radius:calc(1.5 * var(--height));position:relative;margin-top:-100px;z-index:40}.btn-canvas[data-v-ab6ba9f2]{position:relative;margin-top:-80px;z-index:40}","",{version:3,sources:["C:/xampp/htdocs/instalacoes-frontend/resources/views/intranet/components-agendamento/ModalTirarFoto.vue"],names:[],mappings:"AACA,2BACE,gBAAiB,AACjB,wCAAyC,AACzC,kBAAmB,AACnB,kBAAmB,AACnB,UAAY,CACb,AACD,6BACE,kBAAmB,AACnB,iBAAkB,AAClB,UAAY,CACb",file:"ModalTirarFoto.vue",sourcesContent:["\n#btn-snap[data-v-ab6ba9f2] {\n  --height: 1.5rem;\n  border-radius: calc(1.5 * var(--height));\n  position: relative;\n  margin-top: -100px;\n  z-index: 40;\n}\n.btn-canvas[data-v-ab6ba9f2] {\n  position: relative;\n  margin-top: -80px;\n  z-index: 40;\n}\n"],sourceRoot:""}])},1886:function(e,t,a){var i=a(1880);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a(549)("d758312c",i,!0,{})},1911:function(e,t,a){"use strict";var i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("form",{attrs:{enctype:"multipart/form-data",novalidate:""}},[a("div",{staticClass:"card"},[a("div",{staticClass:"card-image"},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.showVideo,expression:"showVideo"}]},[a("video",{ref:"video",attrs:{width:"640",height:"480"}}),e._v(" "),a("div",{staticClass:"is-fullwidth has-text-centered is-marginless is-paddingless"},[a("button",{staticClass:"button is-white is-large",attrs:{type:"button",id:"btn-snap"},on:{click:e.snap}},[a("b-icon",{attrs:{icon:"camera",size:"is-medium"}})],1)])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showCanvas,expression:"showCanvas"}]},[a("canvas",{ref:"canvas",staticClass:"is-4by3",staticStyle:{width:"100%"},attrs:{width:"640",height:"480"}}),e._v(" "),a("b-field",{directives:[{name:"show",rawName:"v-show",value:!e.isLoading,expression:"!isLoading"}],attrs:{position:"is-centered",grouped:""}},[a("p",{staticClass:"control"},[a("button",{staticClass:"btn-canvas button is-danger is-medium",attrs:{type:"button"},on:{click:e.descartar}},[a("b-icon",{attrs:{icon:"delete",size:"is-medium"}}),e._v(" "),a("span",[e._v("Descartar")])],1)]),e._v(" "),a("p",{staticClass:"control"},[a("button",{staticClass:"btn-canvas button is-success is-medium",attrs:{type:"button"},on:{click:e.enviar}},[a("b-icon",{attrs:{icon:"send",size:"is-medium"}}),e._v(" "),a("span",[e._v("Enviar")])],1)])])],1),e._v(" "),a("b-loading",{attrs:{active:e.isLoading,"can-cancel":!1},on:{"update:active":function(t){e.isLoading=t}}})],1)])])},staticRenderFns:[]};t.a=i},555:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(1867),o=a.n(i);for(var n in i)["default","default"].indexOf(n)<0&&function(e){a.d(t,e,function(){return i[e]})}(n);var s=a(1911);var r=function(e){a(1886)},d=a(39)(o.a,s.a,!1,r,"data-v-ab6ba9f2",null);t.default=d.exports}});